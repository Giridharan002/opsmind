// Message handler for OpsMind Bot
response = Map();

// Get user message text - 'message' is already the text string
userMessage = message.toLowerCase();

// Get user name safely
userName = user.get("first_name");
if(userName == null)
{
	userName = "there";
}

card = Map();
card.put("title","OpsMind - AI Operations Intelligence");
card.put("theme","modern-inline");
response.put("card",card);

// Check for greetings
if(userMessage.indexOf("hi") != -1 || userMessage.indexOf("hello") != -1 || userMessage.indexOf("hey") != -1)
{
	response.put("text","ðŸ‘‹ Hi *" + userName + "*! I'm OpsMind, your AI operations assistant.\n\nðŸ’¡ **Quick Commands:**\nâ€¢ `/ops status` - Team operations overview\nâ€¢ `/ops sprint-delay` - AI sprint analysis\nâ€¢ `/ops help` - See all commands\n\nTry typing `/ops` in any chat to get started!");
}
else if(userMessage.indexOf("help") != -1 || userMessage.indexOf("command") != -1)
{
	response.put("text","ðŸ“‹ **Available Commands:**\n\nâ€¢ `/ops status` - Overall team metrics\nâ€¢ `/ops risks` - Tasks at risk\nâ€¢ `/ops overload` - Workload analysis\nâ€¢ `/ops incidents` - Incident patterns\nâ€¢ `/ops sprint-delay` - AI sprint delay analysis\nâ€¢ `/ops help` - Command help\n\nType any of these commands in **any Cliq chat** to use them!");
}
else
{
	response.put("text","ðŸ¤– I'm OpsMind! I can help you monitor operations.\n\nðŸ’¬ Try:\nâ€¢ Asking me about **commands**\nâ€¢ Typing `/ops status` in any chat\nâ€¢ Checking the **OpsMind Widget**\n\nWhat would you like to know?");
}

return response;
